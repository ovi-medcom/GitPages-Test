<!DOCTYPE html>
<html dir="ltr" lang="da-DK">
<head>
<body>
    <h1>FHIR - Messaging Communication Rules</h1>
    OM
    Ole Vilstrup Møller
    <h2>Content</h2>
    - FHIR Messaging (Link HL7)
    - MessageHeader Identifiers & Timestamps 
    - Timestamps
    - Provenance (Link HL7)
    - Reliable Messaging
    - FHIR - Communication rules (Markdown)
    
    <h2>[Rules][Messaging rules]</h2>
    - [Acknowledgment rules]
    ​​- [Error states]
    - [Message states]
    - FHIR Messaging [HL7](http://hl7.org/fhir/R4/messaging.html)
    
    <h2>Messaging - FHIR v4.0.1</h2>
    hl7.org
    FHIR Resources can be used in a traditional messaging context, much like HL7 v2 (see detailed comparison).Applications asserting conformance to this framework claim to be conformant to "FHIR messaging" (see Conformance).. In FHIR messaging, a "reques…
    
    
    <h2>Messaging using FHIR Resources</h2>
    
    FHIR Resources can be used in a traditional messaging context, much like HL7 v2  (see detailed comparison). Applications asserting conformance to this framework claim to be conformant to "FHIR messaging" (see Conformance).
    
    In FHIR messaging, a "request message" is sent from a source application to a destination application when an event happens. Events mostly correspond to things that happen in the real world. The request message consists of a Bundle identified by the type "message", with the first resource in the bundle being a MessageHeader resource. The MessageHeader resource has a code - the message event - that identifies the nature of the request message, and it also carries additional request metadata. The other resources in the bundle depend on the type of the request.
    
    The events supported in FHIR, along with the resources that are included in them, are defined below.
    
    The destination application processes the request and returns one or more response messages which are also a bundle of resources identified by the type "message", with the first resource in each bundle being a MessageHeader resource with a response section that reports the outcome of processing the message and any additional response resources required.
    
    
    
    
    
    MessageHeader Identifiers & Timestamps 
    An incoming message contains two identifiers: the Bundle.id and the MessageHeader.id. Each time a new message is created, it SHALL be assigned an identifier (MessageHeader.id) that is unique within that message stream. Note that since message streams are often merged with other streams, it is recommended that the identifier should be globally unique. This can be achieved by using a UUID or an OID. Each time a message is sent, the Bundle.id should be changed to a new value.
    
    When a receiver receives and processes the message, it responds with a new message with a new identifier, wrapped in a bundle which also has a new id. The response message also quotes the request MessageHeader.id in MessageHeader.response.identifier so that the source system can relate the response to its request.
    
    A message has 2 important timestamps:
    
    Bundle.timestamp: the time the message was sent
    Bundle.meta.lastUpdated: the last time the message was updated (either by storing, or by modification)
    In addition, the message may have additional timestamps in additional resources in the message, either .meta.lastUpdated or others throughout the resources. The meaning of these will depend on the message event.
    
    Timestamp
    http://hl7.org/fhir/R4/datatypes.html#dateTime
    
    Datatypes - FHIR v4.0.1
    hl7.org
    The meaning of the Coding is defined by the code. The system provides the source of the definition of the code, along with an optional version reference. The display is a human display for the text defined by the system - it is not intended for compu…
    Provenance
    http://hl7.org/fhir/R4/provenance.html
    
    Provenance - FHIR v4.0.1
    hl7.org
    6.3.3 Background and Context . The Provenance resource is based on the W3C Provenance specification , and mappings are provided.The Provenance resource is tailored to fit the FHIR use-cases for provenance more directly. In terms of W3C Provenance the…
    Reliable Messaging
    When reliable messaging is implemented , the Receiver SHALL check the incoming Bundle.id and MessageHeader.id against a cache of previously received messages. The correct action to take depends on what is received:
    
    Both the Bundle.id and MessageHeader.id have not been received	This is the normal case, and the message should be processed
    Both envelope and message already received	The original response has been lost (failed to return to the request issuer), and the original response SHALL be resent
    The MessageHeader.id has already been received, but the Bundle.id is new	A previously seen message has been resubmitted for processing again. The server may either reprocess the message, or reject the message
    The Bundle.id has already been received, but the MessageHeader.id is new	This is an error - Bundle.id values should never be reused
    The duration period for caching does generally not need to be very long. At a minimum, it could be 1 minute longer than the timeout of the sending system, though it may need to be longer depending on the re-sending policies of the sending system.
    
    Applications that implement reliable messaging declare their reliable cache period in their Capability Statement.
    
    
    
    FHIR - Communication rules
    Will and should be translated into English
    
    Rules
    Messaging rules
    Acknowledgment rules
    Fejltilstande
    Meddelelsestilstande
    Rules
    Messaging rules
    ID	Regel
    MR1.S	Der skal altid anmodes om kvittering på en FHIR-meddelelse
    MR2.S	En meddelelse markeres som sendt og modtaget, når der er modtaget en AA kvittering
    MR3.S	En meddelelse markeres som fejlet, når der er modtaget en negativ AR kvittering
    MR4.S	En meddelelse markeres som fejlet, når der er modtaget en negativ AE kvittering
    MR5.R	En meddelelse må forsøges gensendt x gange ved modtagelse af en AE Kvittering
    MR6.R	En meddelelse må forsøges gensendt x gange ved manglende modtagelse af en Kvittering
    MR7.R	En meddelelse, der gensendes, skal altid opdateres med ny timestamp=Bundle.timestamp og ny kuvertid=Bundle.id
    MR8.R	En meddelelse er en dublet, hvis den indeholder samme MessageHeader.Id som en tidligere modta-get meddelelse
    Acknowledgment rules
    ID	Regel
    KR1.R	Der skal altid kvitteres på en FHIR-meddelelse
    KR2.R	Der må aldrig kvitteres på en kvitteringsmeddelelse
    KR3.R	Hvis der ikke findes fejl under modtagelse af en meddelelse, kvitteres der positivt med AA
    KR4.R	Hvis der sker en teknisk fejl i modtagersystemet under modtagelse af en meddelelse, kvitteres der negativt med AE
    KR5.R	Hvis en meddelelse validerer negativt mod standardens profilering, kvitteres der negativt med AR
    KR6.S	Hvis en kvittering på en meddelelse ikke er modtaget inden xx minutter, markeres den originale med-delelse til genafsendelse.
    Fejltilstande
    ID	Regel
    F1.S	Hvis en meddelelse er afsendt/gensendt x gange uden at modtage kvittering, sættes meddelelsen i fejltilstand, og afsender skal håndtere problemet uden at bruge videre meddelelseshåndtering.
    F2.S	Hvis en meddelelse er afsendt/gensendt x gange uden at modtage korrekt kvittering, sættes medde-lelsen i fejltilstand, og afsender skal håndtere problemet uden at bruge videre meddelelseshåndte-ring.
    F3.R	Hvis en meddelelse er modtaget x gange selvom der er afsendt korrekt kvittering, sættes meddelel-sen i fejltilstand, og modtager skal håndtere problemet uden at bruge videre meddelelseshåndtering.
    Meddelelsestilstande
    Tilstand	Beskrivelse
    Afventer kvittering	Meddelelsen er sendt, men afventer kvittering
    Kvitteret	Meddelelsen er sendt og kvittering modtaget
    Fejlet	Meddelelsen er sendt og fejlkvittering modtaget, oprindelig meddelelse kan gensendes
    Permanent fejlende	Meddelelsen er sendt og fejlkvittering af Ack AR modtaget, oprindelig meddelelse kan ikke gensendes, da den er markeret som havende en teknisk fejl
    
</body>

</html>